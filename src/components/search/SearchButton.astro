---
import { getLangFromUrl, useTranslations } from '@/i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<button
  id="search-button"
  class="search-button flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-accent dark:hover:text-secondary transition-colors duration-200"
  aria-label={t('search.placeholder')}
>
  <svg
    xmlns="http://www.w3.org/2000/svg"
    class="h-5 w-5 mr-1"
    fill="none"
    viewBox="0 0 24 24"
    stroke="currentColor"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
    />
  </svg>

</button>

<script>
  document.addEventListener('astro:page-load', () => {
    console.log('SearchButton: astro:page-load event fired');
    const searchButton = document.getElementById('search-button');
    console.log('SearchButton: Button element exists:', !!searchButton);

    if (searchButton) {
      // Añadir un evento de clic directo para depuración
      searchButton.addEventListener('click', (e) => {
        console.log('SearchButton: Button clicked directly');
        // Intentar abrir el modal directamente
        const searchModal = document.getElementById('search-modal');
        if (searchModal) {
          console.log('SearchButton: Attempting to open modal directly');
          searchModal.classList.remove('hidden');
          document.body.classList.add('overflow-hidden');

          // Inicializar autocomplete cuando se abre el modal
          setTimeout(() => {
            // Intentar inicializar Algolia Autocomplete
            try {
              const container = document.getElementById('autocomplete');
              if (container && window.autocomplete) {
                console.log('SearchButton: Initializing autocomplete');
                window.autocompleteInstance = window.autocomplete({
                  container: '#autocomplete',
                  placeholder: 'Buscar artículos...',
                  openOnFocus: true,
                  detachedMediaQuery: ''
                });
              }
            } catch (error) {
              console.error('SearchButton: Error initializing autocomplete', error);
            }

            // Enfocar el campo de búsqueda
            const input = document.querySelector('.aa-Input');
            if (input) {
              input.focus();
            }
          }, 100);
        }
      });
    }
  });
</script>
